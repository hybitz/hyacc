<script>
  function updateTaxAmount( detailId ) {
    var detailTr = document.getElementById( detailId );
    var taxAmountField = document.getElementById( detailTr.id + '_tax_amount' );
    var amount = parseInt( document.getElementById( detailTr.id + '_input_amount' ).value );
    var taxType = document.getElementById( detailTr.id + '_tax_type' ).value;
    var ymField = document.getElementById('journal_ym');
    var taxRatePercentField = document.getElementById( detailTr.id + '_tax_rate_percent' );

    var date = ymField.value.substring(0, 4) + '-' + ymField.value.substring(4, 6) + '-01';
    var taxRate = tax.getRateOn(date);

    // 非課税の場合は消費税入力欄を非活性にする
    if ( taxType == tax.NONTAXABLE ) {
      taxRatePercentField.value = '';
      taxAmountField.value = '';
      taxAmountField.disabled = 'disabled';
    }
    // 内税の場合は消費税を自動計算する
    else if ( taxType == tax.INCLUSIVE ) {
      taxRatePercentField.value = taxRate * 100;
      taxAmountField.value = tax.calcTaxAmount(taxType, taxRate, amount);
      taxAmountField.disabled = null;
    }
    // 外税の場合は消費税を自動計算する
    else if ( taxType == tax.EXCLUSIVE ) {
      taxRatePercentField.value = taxRate * 100;
      taxAmountField.value = tax.calcTaxAmount(taxType, taxRate, amount);
      taxAmountField.disabled = null;
    }
    
    journal.refresh_total_amount();
  }

  function flipDetails(show){
    var detailTrs = journal.get_details();
    
    for (var i = 0; i < detailTrs.length; i++) {
      var detail = detailTrs[i];
      var detail2 = document.getElementById(detail.id + '_2');
      var detail3 = document.getElementById(detail.id + '_3');
      var detail4 = document.getElementById(detail.id + '_4');
      var link = document.getElementById(detail.id + '_link');
      
      if (show) {
        detail2.style.display = 'table-row';
        detail3.style.display = 'table-row';
        detail4.style.display = 'table-row';
        link.innerHTML = '<%= message_for_details(true) %>'
      }
      else {
        detail2.style.display = 'none';
        detail3.style.display = 'none';
        detail4.style.display = 'none';
        link.innerHTML = '<%= message_for_details(false) %>'
      }
    }
  }

  function flipDetail(id){
    var detail2 = document.getElementById(id + '_2');
    var detail3 = document.getElementById(id + '_3');
    var detail4 = document.getElementById(id + '_4');
    var link = document.getElementById(id + '_link');
    
    if (detail2.style.display == 'none') {
      detail2.style.display = 'table-row';
      detail3.style.display = 'table-row';
      detail4.style.display = 'table-row';
      link.innerHTML = '<%= message_for_details(true) %>'
    }
    else {
      detail2.style.display = 'none';
      detail3.style.display = 'none';
      detail4.style.display = 'none';
      link.innerHTML = '<%= message_for_details(false) %>'
    }
  }
  
</script>

