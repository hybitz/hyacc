<script>
  $(document).ready(function() {
    hyacc.init_datepicker();
  });
  
  function add_dependent_family_member(trigger) {
    var table = $(trigger).closest('table');
    var params = {
      index: table.find('tbody tr').length,
      format: 'html'
    };

    $.get('<%= url_for :action => 'add_dependent_family_member' %>', params, function(html) {
      table.find('tbody').append(html);
    });
  }
</script>

<%= flash_notice %>

<%= form_for [:mm, @c], :remote => true do |f| %>
  <div style="margin:0px 10px 5px 0px; text-align: right;">
    <%= f.submit %>
  </div>
  <table>
    <tr>
      <th colspan="2">暦年</th><td><%= f.select :yyyy, calendar_years %></td>
      <th colspan="2">従業員</th><td><%= f.collection_select :employee_id, finder.employees, 'id', 'fullname' %></td>
    </tr>
    <tr>
      <th colspan="2">基礎控除</th><td><%= f.text_field :basic, :value => 380000, :class => 'amount' %></td>
      <th colspan="2">小規模共済掛金</th><td><%= f.text_field :small_scale_mutual_aid, :class => 'amount' %></td>
    </tr>
    <tr>
      <th rowspan="2"><%= Exemption.human_attribute_name :life_insurance_premium %></th>
      <th><%= f.label :life_insurance_premium_old %></th>
      <td><%= f.text_field :life_insurance_premium_old, :class => 'amount' %></td>
      <th colspan="2">地震保険料</th><td><%= f.text_field :earthquake_insurance_premium, :class => 'amount' %></td>
    </tr>
      <th><%= f.label :life_insurance_premium_new %></th>
      <td><%= f.text_field :life_insurance_premium_new, :class => 'amount' %></td>
      <th colspan="2">配偶者特別控除</th><td><%= f.text_field :special_tax_for_spouse, :class => 'amount' %></td>
    </tr>
    <tr>
      <th colspan="2">配偶者控除</th><td><%= f.text_field :spouse, :class => 'amount' %></td>
      <th colspan="2">扶養控除</th><td><%= f.text_field :dependents, :class => 'amount' %></td>
    </tr>
    <tr>
      <th colspan="2">住宅借入金控除</th><td><%= f.text_field :mortgage_deduction, :class => 'amount' %></td>
      <th colspan="2">住宅借入金等特別控除適用数</th><td><%= f.text_field :num_of_house_loan, :class => 'amount' %></td>
    </tr>
    <tr>
      <th colspan="2">住宅借入金等特別控除可能額</th><td><%= f.text_field :max_mortgage_deduction, :class => 'amount' %></td>
      <th colspan="2"> </th><td> </td>
    </tr>
    <tr>
      <th colspan="2">居住開始年月日（1回目）</th><td><%= f.text_field :date_of_start_living_1, :class => 'datepicker' %></td>
      <th colspan="2">居住開始年月日（2回目）</th><td><%= f.text_field :date_of_start_living_2, :class => 'datepicker' %></td>
    </tr>
    <tr>
      <th colspan="2">住宅借入金等特別控除区分（1回目）</th><td><%= f.select :mortgage_deduction_code_1, mortgage_deduction_types %></td>
      <th colspan="2">住宅借入金等特別控除区分（2回目）</th><td><%= f.select :mortgage_deduction_code_2, mortgage_deduction_types %></td>
    </tr>
    <tr>
      <th colspan="2">住宅借入金等年末残高（1回目）</th><td><%= f.text_field :year_end_balance_1, :class => 'amount' %></td>
      <th colspan="2">住宅借入金等年末残高（2回目）</th><td><%= f.text_field :year_end_balance_2, :class => 'amount' %></td>
    </tr>
  </table>
  <table width="400">
  <thead>
    <tr>
      <th>控除区分</th>
      <th>氏名</th>
      <th>カナ氏名</th>
      <th>マイナンバー</th>
      <th>国内居住者</th>
      <th>削除</th>
    </tr>
  </thead>
  <tbody>
    <% @c.dependent_family_members.each_with_index do |dfm, i| %>
      <%= render 'dependent_fields', :dfm => dfm, :index => i %>
    <% end %>  
  </tbody>
  <tfoot>
    <tr>
      <td colspan="6" align="right">
        <a href="" onclick="add_dependent_family_member(this); return false;">扶養家族追加</a>
      </td>
    </tr>
  </tfoot>
  </table>
<% end %>
